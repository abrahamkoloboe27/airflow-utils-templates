{
    "cardsV2": [{
        "cardId": "{{ dag_id }}_dag_failure_alert",
        "card": {
            "header": {
                "title": "DAG: {{ dag_id }}",
                "subtitle": "‚ö†Ô∏è √âchec du DAG | DAG Failed",
                "imageUrl": "{% if logo_url %}{{ logo_url }}{% else %}https://img.icons8.com/color/48/high-priority--v1.png{% endif %}"
            },
            "sections": [
                {
                    "header": "R√©sum√© du DAG | DAG Summary",
                    "widgets": [
                        {"textParagraph": {"text": "<b>üìÖ Date d'ex√©cution:</b> {{ execution_date }}"}},
                        {"textParagraph": {"text": "<b>üïí D√©but | Start:</b> {{ start_date }}"}},
                        {"textParagraph": {"text": "<b>üïï Fin | End:</b> {{ end_date }}"}},
                        {"textParagraph": {"text": "<b>‚è±Ô∏è Dur√©e totale | Total Duration:</b> {{ execution_time_str }}"}}{% if dag_description %},
                        {"textParagraph": {"text": "<b>üìù Description:</b> {{ dag_description }}"}}{% endif %}
                    ]
                },
                {
                    "header": "Statistiques des T√¢ches | Task Statistics",
                    "widgets": [
                        {"textParagraph": {"text": "<b>üìä Total des t√¢ches:</b> {{ summary.total_tasks }}"}},
                        {"textParagraph": {"text": "<b>‚úÖ Succ√®s:</b> <font color='#27ae60'>{{ summary.success_count }}</font>"}},
                        {"textParagraph": {"text": "<b>‚ùå √âchecs:</b> <font color='#e74c3c'><b>{{ summary.failed_count }}</b></font>"}}{% if summary.retry_count > 0 %},
                        {"textParagraph": {"text": "<b>üîÑ Retentatives:</b> <font color='#f39c12'>{{ summary.retry_count }}</font>"}}{% endif %}{% if summary.skipped_count > 0 %},
                        {"textParagraph": {"text": "<b>‚è≠Ô∏è Ignor√©es:</b> {{ summary.skipped_count }}"}}{% endif %}
                    ]
                },
                {% if failed_tasks %}
                {
                    "header": "T√¢ches √âchou√©es | Failed Tasks",
                    "widgets": [
                        {% for task in failed_tasks %}
                        {
                            "decoratedText": {
                                "topLabel": "‚ùå {{ task.task_id }}",
                                "text": "Dur√©e: {{ task.duration if task.duration else 'N/A' }} | Essais: {{ task.try_number }}",
                                "icon": {"materialIcon": {"name": "error"}},
                                "bottomLabel": "{{ task.state }}"
                            }
                        }{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ]
                },
                {% endif %}
                {
                    "header": "Toutes les T√¢ches | All Tasks",
                    "collapsible": true,
                    "widgets": [
                        {% for task in summary.tasks %}
                        {
                            "decoratedText": {
                                "topLabel": "{{ task.task_id }}",
                                "text": "Dur√©e: {{ task.duration if task.duration else 'N/A' }} | Essais: {{ task.try_number }}",
                                {% if task.state.lower() == 'success' %}
                                "icon": {"materialIcon": {"name": "check_circle"}},
                                {% elif task.state.lower() == 'failed' %}
                                "icon": {"materialIcon": {"name": "error"}},
                                {% elif task.state.lower() in ['up_for_retry', 'up_for_reschedule'] %}
                                "icon": {"materialIcon": {"name": "refresh"}},
                                {% else %}
                                "icon": {"materialIcon": {"name": "help"}},
                                {% endif %}
                                "bottomLabel": "{{ task.state }}"
                            }
                        }{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ]
                }
            ]
        }
    }]
}
